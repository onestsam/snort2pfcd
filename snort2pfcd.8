.\"
.\" snort2pfcd
.\" Copyright (c) 2016 Samee Shahzada <onestsam@gmail.com>
.\"
.\" Based on snort2c
.\" Copyright (c) 2005 Antonio Benojar <zz.stalker@gmail.com>
.\" Copyright (c) 2002 Cedric Berger
.\"
.\" Expiretable functions from expiretable
.\" Copyright (c) 2005 Henrik Gustafsson <henrik.gustafsson@fnord.se>
.\"
.\" s2c_parse_line based in pfctl code (pfctl_radix.c)
.\" Copyright (c) Armin's Wolfermann
.\"
.\" s2c_pf_block functions are based
.\" on Armin's Wolfermann pftabled-1.03 functions.
.\"
.\" All rights reserved.
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.\"
.Dd October 12, 2016
.Dt SNORT2PFCD 8
.Sh NAME
.Nm snort2pfcd
.Nd provides real-time blocking of ip addresses from snort alerts via the packet filter firewall for a specified period of time.
.Sh SYNOPSIS
.Nm snort2pfcd
.Op Fl e Ar External Interface
.Op Fl w Ar WhiteListFile
.Op Fl b Ar BlackListFile
.Op Fl B
.Op Fl l Ar LogFile
.Op Fl a Ar AlertFile
.Op Fl t Ar Seconds
.Op Fl h
.Sh DESCRIPTION
.Nm
analyzes snort alert output and blocks ip addresses using pf for a specified
period of time. Expiration of entries use Henrik Gustafsson's expiretable 
functions. A whitelist is specified to exclude local and trusted ip address 
from being blocked. Whitelist entries can be single ip addressess or blocks 
of addresses in CIDR format (255.255.255.255/32). This program is based on 
snort2c written by Antonio Benojar which was based on the original snort2pf 
perl script written by Stephan Schmieder.
.Pp
While
.Nm
will parse the default snort alert file, this can produce less than real-time 
blocking given the burden being placed on snort especially over an active, fast 
or low latency connection. Would strongly recommend using a spooler like barnyard2
to output the text alerts from the snort unified2 binary output.
.Pp
By default, the user-supplied whitelist is prepended with the addresses of all of 
the local interfaces as the handling of these addresses are usually specified by 
more complex pf rules and simply blocking these addresses can cause problems with 
certain configurations.
.Pp
The user-supplied whitelist can also be prepended with the address of the external 
interface only for paranoid configurations. Lo0 is always whitelisted.
.Pp
.Nm
also automatically whitelists addresses found within the /etc/resolv.conf file as these
addresses should also be handled by specific pf rules.
.Pp
A static blacklist table is also maintained and populated within pf with the addresses
found within the /usr/local/etc/snort/rules/iplists/default.blacklist file. These addresses
can be supplied by the user or automatically populated with addresses supplied by the snort
and pulledpork communities.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl e Ar External Interface
external interface e.g. eth0 or "all" to whitelist all interfaces, default is to whitelist all interfaces
.It Fl w Ar WhiteListFile
whitelist file, default is /usr/local/etc/snort/rules/iplists/default.whitelist.
.It Fl b Ar BlackListFile
blacklist file, default is /usr/local/etc/snort/rules/iplists/default.blacklist.
.It Fl B 
If set, will prevent loading of any blacklist file
.It Fl l Ar LogFile
log file, default is /var/log/snort2pfcd.log.
.It Fl a Ar AlertFile
snort alert file, default is /var/log/snort/alert.
.It Fl p Ar Priority 
Priority level to block ip addresses in snort logs, default is 1. 
Lower priority includes higher priority, for example, -p 3 includes priorities 3, 2 and 1. 
.It Fl t Ar Seconds 
Seconds to block an ip address, default is 60*60*3 or 3 hours.
.It Fl h
Show help.
.El
.Sh SEE ALSO
.Xr pf 4 ,
.Xr pfctl 8 ,
.Xr snort 8
.Xr libcidr 3
.Sh AUTHORS
Samee Shahzada <onestsam@gmail.com>
